<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Legendary Doodle Jump</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #222; font-family: 'Segoe UI', sans-serif; color: #fff; overflow: hidden; }
    .screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }
    #startScreen, #loseScreen { display: flex; }
    h1 { font-size: 3em; margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
    p, li { font-size: 1.2em; margin-bottom: 10px; }
    ul { text-align: left; }
    button {
      padding: 12px 24px;
      font-size: 1.2em;
      border: none;
      border-radius: 5px;
      background: #03dac6;
      color: #222;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.05); }
    #gameScreen { background: #000; display: flex; flex-direction: column; }
    #gameCanvas { background: #333; border: 3px solid #fff; margin: 10px auto; display: block; }
  </style>
</head>
<body>
  <!-- Start Menu Screen -->
  <div id="startScreen" class="screen">
    <h1>Legendary Doodle Jump</h1>
    <p>Welcome to a doodle jump experience like no other!</p>
    <p><strong>How to Play:</strong></p>
    <ul>
      <li>Use the left/right arrow keys (or tap left/right on mobile) to move.</li>
      <li>Jump on platforms to climb higher.</li>
      <li>Collect power-ups for epic boosts:</li>
      <ul>
        <li><strong>Jetpack:</strong> Gives an extra-boost jump!</li>
        <li><strong>Slow Motion:</strong> Temporarily slows gravity.</li>
      </ul>
      <li>The higher you go, the faster the levelâ€”and the tougher it gets!</li>
      <li>If you fall below the screen, the game is over.</li>
    </ul>
    <button id="startButton">Start Game</button>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="screen">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
  </div>

  <!-- Lose Screen -->
  <div id="loseScreen" class="screen">
    <h1>Game Over</h1>
    <p id="finalScore"></p>
    <button id="restartButton">Restart Game</button>
  </div>

  <script>
    // Screen elements
    const startScreen = document.getElementById("startScreen");
    const gameScreen = document.getElementById("gameScreen");
    const loseScreen = document.getElementById("loseScreen");
    const startButton = document.getElementById("startButton");
    const restartButton = document.getElementById("restartButton");
    const finalScoreEl = document.getElementById("finalScore");

    // Canvas & Context
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Game variables
    let animationFrameId;
    let gameOver = false;
    let score = 0;
    let level = 1;
    const gravity = 0.5;
    const friction = 0.9;

    // Player (the doodler)
    let player = {
      x: canvas.width / 2 - 15,
      y: 500,
      width: 30,
      height: 30,
      vx: 0,
      vy: 0,
      jumpForce: -12,
      powerUp: null,   // "jetpack" or "slow"
      powerUpTime: 0   // frames remaining for power-up
    };

    // Platforms array
    let platforms = [];
    // Power-ups array: each has x, y, width, height, type ("jetpack" or "slow")
    let powerUps = [];

    // Key input tracking
    let keys = {};
    document.addEventListener("keydown", (e) => { keys[e.code] = true; });
    document.addEventListener("keyup", (e) => { keys[e.code] = false; });

    // Touch controls for mobile: tap left/right half of canvas
    canvas.addEventListener("touchstart", (e) => {
      e.preventDefault();
      let touchX = e.touches[0].clientX;
      if (touchX < canvas.width / 2) keys["ArrowLeft"] = true;
      else keys["ArrowRight"] = true;
    });
    canvas.addEventListener("touchend", () => {
      keys["ArrowLeft"] = false;
      keys["ArrowRight"] = false;
    });

    // Initialize platforms
    function initPlatforms() {
      platforms = [];
      // Create a base platform
      platforms.push({ x: 150, y: 580, width: 100, height: 10 });
      // Create several platforms upward
      for (let i = 0; i < 10; i++) {
        platforms.push({
          x: Math.random() * (canvas.width - 80),
          y: 600 - i * 60,
          width: 80 + Math.random() * 40,
          height: 10
        });
      }
    }

    // Possibly add a power-up on a platform (20% chance)
    function maybeAddPowerUp(platform) {
      if (Math.random() < 0.2) {
        let type = Math.random() < 0.5 ? "jetpack" : "slow";
        powerUps.push({
          x: platform.x + platform.width / 2 - 10,
          y: platform.y - 20,
          width: 20,
          height: 20,
          type: type
        });
      }
    }

    // Initialize/restart the game
    function initGame() {
      gameOver = false;
      score = 0;
      level = 1;
      player.x = canvas.width / 2 - 15;
      player.y = 500;
      player.vx = 0;
      player.vy = 0;
      player.powerUp = null;
      player.powerUpTime = 0;
      player.jumpForce = -12;
      initPlatforms();
      powerUps = [];
    }

    // Update game state
    function update() {
      // Handle left/right input
      if (keys["ArrowLeft"]) player.vx = -5;
      else if (keys["ArrowRight"]) player.vx = 5;
      else player.vx *= friction;

      // Apply gravity (or slow gravity if power-up active)
      if (player.powerUp === "slow") player.vy += gravity * 0.3;
      else player.vy += gravity;

      // Update player position
      player.x += player.vx;
      player.y += player.vy;

      // Horizontal wrap-around
      if (player.x < -player.width) player.x = canvas.width;
      if (player.x > canvas.width) player.x = -player.width;

      // Check collision with platforms (only when falling)
      for (let plat of platforms) {
        if (player.vy > 0 &&
            player.x + player.width > plat.x &&
            player.x < plat.x + plat.width &&
            player.y + player.height > plat.y &&
            player.y + player.height < plat.y + plat.height + player.vy) {
          player.y = plat.y - player.height;
          player.vy = player.jumpForce;
          score += 10;
          maybeAddPowerUp(plat);
        }
      }

      // Check collision with power-ups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        let pu = powerUps[i];
        if (player.x < pu.x + pu.width &&
            player.x + player.width > pu.x &&
            player.y < pu.y + pu.height &&
            player.y + player.height > pu.y) {
          // Activate power-up effect
          if (pu.type === "jetpack") {
            player.vy = player.jumpForce * 1.5;
          } else if (pu.type === "slow") {
            player.powerUp = "slow";
            player.powerUpTime = 300; // lasts ~5 seconds (300 frames)
          }
          powerUps.splice(i, 1);
          score += 50;
        }
      }

      // Power-up timer decrement
      if (player.powerUp) {
        player.powerUpTime--;
        if (player.powerUpTime <= 0) player.powerUp = null;
      }

      // If player reaches upper half, scroll platforms and power-ups downward
      if (player.y < canvas.height / 2) {
        let diff = canvas.height / 2 - player.y;
        player.y = canvas.height / 2;
        platforms.forEach(plat => plat.y += diff);
        powerUps.forEach(pu => pu.y += diff);
        score += Math.floor(diff);
      }

      // Remove platforms that have scrolled off-screen and add new ones
      platforms = platforms.filter(plat => plat.y < canvas.height);
      while (platforms.length < 12) {
        platforms.push({
          x: Math.random() * (canvas.width - 80),
          y: -Math.random() * 20,
          width: 80 + Math.random() * 40,
          height: 10
        });
      }

      // Level progression: every 500 points, increase level and challenge
      if (score > level * 500) {
        level++;
        // Make the jump a bit more challenging
        player.jumpForce -= 1;
      }

      // Game over condition: player falls below the screen
      if (player.y > canvas.height) endGame();
    }

    // Draw everything on the canvas
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Background
      ctx.fillStyle = "#333";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      // Platforms
      ctx.fillStyle = "#8bc34a";
      platforms.forEach(plat => {
        ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
      });
      // Power-ups
      powerUps.forEach(pu => {
        if (pu.type === "jetpack") ctx.fillStyle = "#ffeb3b";
        else if (pu.type === "slow") ctx.fillStyle = "#03a9f4";
        ctx.fillRect(pu.x, pu.y, pu.width, pu.height);
      });
      // Player (a simple white square)
      ctx.fillStyle = "#fff";
      ctx.fillRect(player.x, player.y, player.width, player.height);
      // HUD: Score, Level, and active Power-Up
      ctx.fillStyle = "#fff";
      ctx.font = "16px Arial";
      ctx.fillText("Score: " + score, 10, 20);
      ctx.fillText("Level: " + level, 10, 40);
      if (player.powerUp) {
        ctx.fillText("Power-Up: " + player.powerUp, 10, 60);
      }
    }

    // Main game loop
    function gameLoop() {
      update();
      draw();
      animationFrameId = requestAnimationFrame(gameLoop);
    }

    // End the game, show lose screen
    function endGame() {
      cancelAnimationFrame(animationFrameId);
      gameScreen.style.display = "none";
      loseScreen.style.display = "flex";
      finalScoreEl.textContent = "Your Score: " + score;
    }

    // Start or restart game when buttons are clicked
    startButton.addEventListener("click", () => {
      startScreen.style.display = "none";
      loseScreen.style.display = "none";
      gameScreen.style.display = "flex";
      initGame();
      gameLoop();
    });
    restartButton.addEventListener("click", () => {
      loseScreen.style.display = "none";
      startScreen.style.display = "none";
      gameScreen.style.display = "flex";
      initGame();
      gameLoop();
    });
  </script>
</body>
</html>